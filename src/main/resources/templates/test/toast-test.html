<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <title>Toast ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
  <link th:href="@{/webjars/bootstrap/dist/css/bootstrap.css}" rel="stylesheet">
  <style>
    .test-container {
      max-width: 800px;
      margin: 50px auto;
      padding: 30px;
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .test-result {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      background-color: #f8f9fa;
    }
  </style>
</head>
<body>
<div class="container test-container">
  <h1 class="mb-4">ğŸ Toast ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>

  <!-- 1. TOAST ê°ì²´ ì¡´ì¬ í™•ì¸ -->
  <div class="test-section">
    <h3>1ï¸âƒ£ TOAST ê°ì²´ ì „ì—­ ë“±ë¡ í™•ì¸</h3>
    <button class="btn btn-primary" onclick="checkToastObject()">ê°ì²´ í™•ì¸</button>
    <div id="result1" class="test-result"></div>
  </div>

  <!-- 2. 4ê°€ì§€ íƒ€ì… ë©”ì„œë“œ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h3>2ï¸âƒ£ 4ê°€ì§€ íƒ€ì… ë©”ì„œë“œ í…ŒìŠ¤íŠ¸</h3>
    <div class="d-flex gap-2 flex-wrap">
      <button class="btn btn-success" onclick="testSuccess()">ì„±ê³µ ë©”ì‹œì§€</button>
      <button class="btn btn-info" onclick="testInfo()">ì •ë³´ ë©”ì‹œì§€</button>
      <button class="btn btn-warning" onclick="testWarning()">ê²½ê³  ë©”ì‹œì§€</button>
      <button class="btn btn-danger" onclick="testError()">ì—ëŸ¬ ë©”ì‹œì§€</button>
    </div>
    <div id="result2" class="test-result"></div>
  </div>

  <!-- 3. XSS ë°©ì§€ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h3>3ï¸âƒ£ XSS ë°©ì§€ í…ŒìŠ¤íŠ¸</h3>
    <button class="btn btn-warning" onclick="testXSS()">XSS ê³µê²© ì‹œë®¬ë ˆì´ì…˜</button>
    <div id="result3" class="test-result"></div>
  </div>

  <!-- 4. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h3>4ï¸âƒ£ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ í…ŒìŠ¤íŠ¸</h3>
    <button class="btn btn-secondary" onclick="testMemoryLeak()">ì—°ì† Toast ìƒì„± (10ê°œ)</button>
    <div id="result4" class="test-result"></div>
  </div>

  <!-- 5. ìë™ ì‚¬ë¼ì§ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h3>5ï¸âƒ£ ìë™ ì‚¬ë¼ì§ í…ŒìŠ¤íŠ¸</h3>
    <button class="btn btn-primary" onclick="testAutoHide()">1ì´ˆ í›„ ìë™ ì‚¬ë¼ì§</button>
    <div id="result5" class="test-result"></div>
  </div>

  <!-- í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° -->
  <div class="mt-4">
    <a th:href="@{/}" class="btn btn-secondary">â† í™ˆìœ¼ë¡œ</a>
  </div>
</div>

<script th:src="@{/webjars/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/toast-util.js}"></script>

<script>
  /**
   * 1. TOAST ê°ì²´ ì¡´ì¬ í™•ì¸
   */
  function checkToastObject() {
    const result1 = document.getElementById('result1');

    if (typeof TOAST === 'undefined') {
      result1.innerHTML = 'âŒ ì‹¤íŒ¨: TOAST ê°ì²´ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
      result1.style.backgroundColor = '#f8d7da';
      return;
    }

    const methods = ['showSuccess', 'showInfo', 'showWarning', 'showError', '_show', '_escapeHtml'];
    const missingMethods = methods.filter(method => typeof TOAST[method] !== 'function');

    if (missingMethods.length > 0) {
      result1.innerHTML = `âŒ ì‹¤íŒ¨: ëˆ„ë½ëœ ë©”ì„œë“œ: ${missingMethods.join(', ')}`;
      result1.style.backgroundColor = '#f8d7da';
      return;
    }

    result1.innerHTML = `
      âœ… ì„±ê³µ: TOAST ê°ì²´ê°€ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
      - typeof TOAST: ${typeof TOAST}<br>
      - ë©”ì„œë“œ ê°œìˆ˜: ${methods.length}ê°œ<br>
      - ëª¨ë“  ë©”ì„œë“œ ì¡´ì¬: ${methods.join(', ')}
    `;
    result1.style.backgroundColor = '#d4edda';

    TOAST.showSuccess('TOAST ê°ì²´ í™•ì¸ ì™„ë£Œ!', 2000);
  }

  /**
   * 2. 4ê°€ì§€ íƒ€ì… ë©”ì„œë“œ í…ŒìŠ¤íŠ¸
   */
  function testSuccess() {
    TOAST.showSuccess('ì´ê²ƒì€ ì„±ê³µ ë©”ì‹œì§€ì…ë‹ˆë‹¤.', 3000);
    logTest('ì„±ê³µ ë©”ì‹œì§€ í˜¸ì¶œ ì™„ë£Œ');
  }

  function testInfo() {
    TOAST.showInfo('ì´ê²ƒì€ ì •ë³´ ë©”ì‹œì§€ì…ë‹ˆë‹¤.', 3000);
    logTest('ì •ë³´ ë©”ì‹œì§€ í˜¸ì¶œ ì™„ë£Œ');
  }

  function testWarning() {
    TOAST.showWarning('ì´ê²ƒì€ ê²½ê³  ë©”ì‹œì§€ì…ë‹ˆë‹¤.', 4000);
    logTest('ê²½ê³  ë©”ì‹œì§€ í˜¸ì¶œ ì™„ë£Œ');
  }

  function testError() {
    TOAST.showError('ì´ê²ƒì€ ì—ëŸ¬ ë©”ì‹œì§€ì…ë‹ˆë‹¤.', 5000);
    logTest('ì—ëŸ¬ ë©”ì‹œì§€ í˜¸ì¶œ ì™„ë£Œ');
  }

  function logTest(message) {
    const result2 = document.getElementById('result2');
    const timestamp = new Date().toLocaleTimeString();
    result2.innerHTML += `[${timestamp}] ${message}<br>`;
    result2.style.backgroundColor = '#d4edda';
  }

  /**
   * 3. XSS ë°©ì§€ í…ŒìŠ¤íŠ¸
   */
  function testXSS() {
    const maliciousScript = '<script>alert("XSS Attack!")</script>';
    TOAST.showWarning(maliciousScript, 5000);

    const result3 = document.getElementById('result3');
    result3.innerHTML = `
      âœ… XSS ë°©ì§€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ<br>
      - ì…ë ¥: ${maliciousScript}<br>
      - Toastì— ìŠ¤í¬ë¦½íŠ¸ê°€ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œë˜ë©´ ì„±ê³µ<br>
      - alert ì°½ì´ ëœ¨ì§€ ì•Šìœ¼ë©´ XSS ë°©ì§€ ì„±ê³µ
    `;
    result3.style.backgroundColor = '#d4edda';
  }

  /**
   * 4. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ í…ŒìŠ¤íŠ¸
   */
  function testMemoryLeak() {
    const result4 = document.getElementById('result4');
    result4.innerHTML = 'í…ŒìŠ¤íŠ¸ ì‹œì‘...<br>';

    for (let i = 1; i <= 10; i++) {
      setTimeout(() => {
        TOAST.showInfo(`Toast #${i}`, 1000);
        result4.innerHTML += `[${new Date().toLocaleTimeString()}] Toast #${i} ìƒì„±<br>`;
      }, i * 200);
    }

    setTimeout(() => {
      const toastContainer = document.getElementById('toast-container');
      const toastCount = toastContainer ? toastContainer.children.length : 0;

      result4.innerHTML += `<br>âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ<br>`;
      result4.innerHTML += `- í˜„ì¬ Toast ê°œìˆ˜: ${toastCount}ê°œ<br>`;
      result4.innerHTML += `- ëª¨ë“  Toastê°€ ìë™ìœ¼ë¡œ ì œê±°ë˜ë©´ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ ì„±ê³µ`;
      result4.style.backgroundColor = '#d4edda';
    }, 3000);
  }

  /**
   * 5. ìë™ ì‚¬ë¼ì§ í…ŒìŠ¤íŠ¸
   */
  function testAutoHide() {
    const result5 = document.getElementById('result5');
    result5.innerHTML = '1ì´ˆ í›„ ìë™ ì‚¬ë¼ì§€ëŠ” Toast ìƒì„± ì¤‘...<br>';

    TOAST.showSuccess('1ì´ˆ í›„ ì‚¬ë¼ì§‘ë‹ˆë‹¤!', 1000);

    setTimeout(() => {
      result5.innerHTML += `âœ… Toastê°€ 1ì´ˆ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤.`;
      result5.style.backgroundColor = '#d4edda';
    }, 1500);
  }

  /**
   * í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
   */
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Toast í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
    console.log('TOAST ê°ì²´:', TOAST);
  });
</script>

</body>
</html>

