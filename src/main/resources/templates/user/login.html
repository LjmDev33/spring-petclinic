<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card shadow">
        <div class="card-body p-5">
          <h2 class="text-center mb-4">로그인</h2>

          <!-- Flash 메시지 -->
          <div th:if="${param.error}" class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i> 아이디 또는 비밀번호가 올바르지 않습니다.
          </div>

          <div th:if="${param.logout}" class="alert alert-success" role="alert">
            <i class="bi bi-check-circle-fill"></i> 로그아웃되었습니다.
          </div>

          <div th:if="${message}" class="alert alert-success" role="alert">
            <i class="bi bi-check-circle-fill"></i> <span th:text="${message}"></span>
          </div>

          <!-- 로그인 폼 -->
          <form th:action="@{/login}" method="post" id="loginForm">
            <div class="mb-3">
              <label for="username" class="form-label">
                <i class="bi bi-person"></i> 아이디
              </label>
              <input type="text"
                     id="username"
                     name="username"
                     class="form-control"
                     placeholder="아이디를 입력하세요"
                     required
                     autofocus>
            </div>

            <div class="mb-3">
              <label for="password" class="form-label">
                <i class="bi bi-lock"></i> 비밀번호
              </label>
              <input type="password"
                     id="password"
                     name="password"
                     class="form-control"
                     placeholder="비밀번호를 입력하세요"
                     required>
            </div>

            <div class="mb-3 form-check">
              <input type="checkbox"
                     id="save-username"
                     name="save-username"
                     class="form-check-input">
              <label for="save-username" class="form-check-label">
                <i class="bi bi-bookmark"></i> 아이디 저장
              </label>
            </div>

            <div class="mb-3 form-check">
              <input type="checkbox"
                     id="remember-me"
                     name="remember-me"
                     class="form-check-input">
              <label for="remember-me" class="form-check-label">
                <i class="bi bi-shield-check"></i> 자동 로그인 (7일간 유지)
              </label>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary" style="height: 42px;">
                <i class="bi bi-box-arrow-in-right"></i> 로그인
              </button>
            </div>
          </form>

          <script>
            // 페이지 로드 시 저장된 아이디 불러오기
            document.addEventListener('DOMContentLoaded', function() {
              const savedUsername = getCookie('savedUsername');
              if (savedUsername) {
                document.getElementById('username').value = savedUsername;
                document.getElementById('save-username').checked = true;
              }
            });

            // 폼 제출 시 아이디 저장 처리
            document.getElementById('loginForm').addEventListener('submit', function(e) {
              const username = document.getElementById('username').value;
              const saveUsername = document.getElementById('save-username').checked;

              if (saveUsername) {
                // 아이디 저장 (30일)
                setCookie('savedUsername', username, 30);
              } else {
                // 아이디 삭제
                deleteCookie('savedUsername');
              }
            });

            // 쿠키 설정 함수
            function setCookie(name, value, days) {
              const date = new Date();
              date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
              const expires = "expires=" + date.toUTCString();
              document.cookie = name + "=" + value + ";" + expires + ";path=/";
            }

            // 쿠키 읽기 함수
            function getCookie(name) {
              const nameEQ = name + "=";
              const ca = document.cookie.split(';');
              for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
              }
              return null;
            }

            // 쿠키 삭제 함수
            function deleteCookie(name) {
              document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            }
          </script>

          <hr class="my-4">

          <!-- 추가 링크 -->
          <div class="text-center">
            <p class="mb-2">
              <a th:href="@{/register}" class="text-decoration-none">
                <i class="bi bi-person-plus"></i> 회원가입
              </a>
            </p>
            <p class="mb-0">
              <a th:href="@{/forgot-password}" class="text-decoration-none text-muted">
                <i class="bi bi-question-circle"></i> 비밀번호 찾기
              </a>
            </p>
          </div>

          <!-- 회원 로그인 안내 -->
          <div class="alert alert-light mt-4" role="alert">
            <i class="bi bi-info-circle"></i>
            <strong>회원 로그인 안내</strong>
            <ul class="mb-0 mt-2 small">
              <li>회원가입 후 로그인하시면 더 많은 서비스를 이용하실 수 있습니다.</li>
              <li><strong>아이디 저장</strong>: 체크 시 30일간 아이디가 저장됩니다.</li>
              <li><strong>자동 로그인</strong>: 체크 시 7일간 로그인 상태가 유지됩니다.</li>
              <li>공용 PC에서는 아이디 저장 및 자동 로그인을 사용하지 마세요.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
