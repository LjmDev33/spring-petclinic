<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow">
        <div class="card-body p-5">
          <h2 class="text-center mb-4">회원가입</h2>

          <!-- Flash 메시지 -->
          <div th:if="${error}" class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i> <span th:text="${error}"></span>
          </div>

          <!-- 회원가입 폼 -->
          <form th:action="@{/register}" method="post" onsubmit="return validateForm()">
            <div class="mb-3">
              <label for="username" class="form-label">
                <i class="bi bi-person"></i> 아이디 <span class="text-danger">*</span>
              </label>
              <input type="text"
                     id="username"
                     name="username"
                     class="form-control"
                     placeholder="4-20자의 영문, 숫자"
                     pattern="[a-zA-Z0-9]{4,20}"
                     required
                     autofocus>
              <small class="form-text text-muted">4-20자의 영문 대소문자, 숫자만 사용 가능합니다.</small>
            </div>

            <div class="mb-3">
              <label for="password" class="form-label">
                <i class="bi bi-lock"></i> 비밀번호 <span class="text-danger">*</span>
              </label>
              <input type="password"
                     id="password"
                     name="password"
                     class="form-control"
                     placeholder="8자 이상의 비밀번호"
                     minlength="8"
                     required>
              <small class="form-text text-muted">8자 이상의 비밀번호를 입력하세요.</small>
            </div>

            <div class="mb-3">
              <label for="passwordConfirm" class="form-label">
                <i class="bi bi-lock-fill"></i> 비밀번호 확인 <span class="text-danger">*</span>
              </label>
              <input type="password"
                     id="passwordConfirm"
                     name="passwordConfirm"
                     class="form-control"
                     placeholder="비밀번호를 다시 입력하세요"
                     required>
              <div id="passwordError" class="text-danger small" style="display: none;">
                비밀번호가 일치하지 않습니다.
              </div>
            </div>

            <div class="mb-3">
              <label for="name" class="form-label">
                <i class="bi bi-person-badge"></i> 이름 <span class="text-danger">*</span>
              </label>
              <input type="text"
                     id="name"
                     name="name"
                     class="form-control"
                     placeholder="실명을 입력하세요"
                     required>
            </div>

            <div class="mb-3">
              <label for="nickname" class="form-label">
                <i class="bi bi-chat-dots"></i> 닉네임 <span class="text-danger">*</span>
              </label>
              <input type="text"
                     id="nickname"
                     name="nickname"
                     class="form-control"
                     placeholder="게시판에 표시될 닉네임"
                     pattern="[a-zA-Z0-9가-힣]{2,15}"
                     maxlength="15"
                     required>
              <small class="form-text text-muted">2-15자의 한글, 영문, 숫자만 사용 가능합니다.</small>
            </div>

            <div class="mb-3">
              <label for="email" class="form-label">
                <i class="bi bi-envelope"></i> 이메일 <span class="text-danger">*</span>
              </label>
              <input type="email"
                     id="email"
                     name="email"
                     class="form-control"
                     placeholder="example@email.com"
                     required>
            </div>

            <div class="mb-4">
              <label for="phone" class="form-label">
                <i class="bi bi-telephone"></i> 전화번호
              </label>
              <input type="tel"
                     id="phone"
                     name="phone"
                     class="form-control"
                     placeholder="숫자만 입력하세요 (자동으로 형식이 적용됩니다)"
                     maxlength="13">
              <small class="form-text text-muted">
                선택사항입니다. 숫자만 입력하면 자동으로 010-0000-0000 형식으로 변환됩니다.
              </small>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary" style="height: 42px;">
                <i class="bi bi-person-plus"></i> 회원가입
              </button>
            </div>
                <i class="bi bi-arrow-left"></i> 로그인으로 돌아가기
              </a>
            </div>
          </form>

          <!-- 회원가입 안내 -->
          <div class="alert alert-info mt-4" role="alert">
            <i class="bi bi-info-circle-fill"></i>
            <strong>회원가입 안내</strong>
            <ul class="mb-0 mt-2 small">
              <li>모든 필수 항목(*)을 입력해주세요.</li>
              <li>아이디와 이메일은 중복될 수 없습니다.</li>
              <li>입력하신 정보는 안전하게 보관됩니다.</li>
              <li>회원가입 후 즉시 로그인이 가능합니다.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  /**
   * 폼 제출 전 비밀번호 일치 여부 검증
   */
  function validateForm() {
    const password = document.getElementById('password').value;
    const passwordConfirm = document.getElementById('passwordConfirm').value;
    const passwordError = document.getElementById('passwordError');

    if (password !== passwordConfirm) {
      passwordError.style.display = 'block';
      document.getElementById('passwordConfirm').classList.add('is-invalid');
      return false;
    }

    passwordError.style.display = 'none';
    document.getElementById('passwordConfirm').classList.remove('is-invalid');
    return true;
  }

  /**
   * 실시간 비밀번호 확인
   */
  document.getElementById('passwordConfirm').addEventListener('input', function() {
    const password = document.getElementById('password').value;
    const passwordConfirm = this.value;
    const passwordError = document.getElementById('passwordError');

    if (passwordConfirm && password !== passwordConfirm) {
      passwordError.style.display = 'block';
      this.classList.add('is-invalid');
    } else {
      passwordError.style.display = 'none';
      this.classList.remove('is-invalid');
    }
  });

  /**
   * 전화번호 자동 포맷팅 (010-0000-0000)
   * - 숫자만 입력 가능
   * - 자동으로 하이픈(-) 추가
   * - 최대 13자 (010-0000-0000)
   */
  document.getElementById('phone').addEventListener('input', function(e) {
    // 1. 숫자만 추출
    let value = e.target.value.replace(/[^0-9]/g, '');

    // 2. 최대 11자리까지만 허용 (01012345678)
    if (value.length > 11) {
      value = value.substring(0, 11);
    }

    // 3. 포맷팅 적용
    let formatted = '';
    if (value.length <= 3) {
      // 3자리 이하: 그대로 표시
      formatted = value;
    } else if (value.length <= 7) {
      // 4~7자리: 010-0000
      formatted = value.substring(0, 3) + '-' + value.substring(3);
    } else {
      // 8자리 이상: 010-0000-0000
      formatted = value.substring(0, 3) + '-' + value.substring(3, 7) + '-' + value.substring(7);
    }

    // 4. 포맷팅된 값 적용
    e.target.value = formatted;

    // 5. 사용자 피드백 (완전한 형식인지 확인)
    if (value.length === 11) {
      e.target.classList.add('is-valid');
      e.target.classList.remove('is-invalid');
    } else if (value.length > 0) {
      e.target.classList.remove('is-valid');
      e.target.classList.add('is-invalid');
    } else {
      e.target.classList.remove('is-valid');
      e.target.classList.remove('is-invalid');
    }
  });

  /**
   * 전화번호 입력 필드 포커스 아웃 시 검증
   */
  document.getElementById('phone').addEventListener('blur', function(e) {
    const value = e.target.value.replace(/[^0-9]/g, '');

    // 전화번호가 입력되었으나 11자리가 아닌 경우
    if (value.length > 0 && value.length !== 11) {
      alert('전화번호는 11자리 숫자를 입력해주세요. (예: 01012345678)');
      e.target.focus();
    }
  });
</script>
</body>
</html>
