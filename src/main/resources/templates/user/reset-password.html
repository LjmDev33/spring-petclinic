<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<body>
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card shadow">
        <div class="card-body p-5">
          <h2 class="text-center mb-4">
            <i class="bi bi-shield-lock"></i> 비밀번호 재설정
          </h2>

          <!-- 안내 메시지 -->
          <div class="alert alert-info" role="alert">
            <i class="bi bi-info-circle"></i>
            <strong>비밀번호 재설정</strong>
            <p class="mb-0 mt-2 small">
              새로운 비밀번호를 입력하세요.<br>
              <span th:if="${email}" class="fw-bold" th:text="${email}"></span>
            </p>
          </div>

          <!-- Flash 메시지 -->
          <div th:if="${message}" class="alert alert-success" role="alert">
            <i class="bi bi-check-circle-fill"></i> <span th:text="${message}"></span>
          </div>

          <div th:if="${error}" class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i> <span th:text="${error}"></span>
          </div>

          <!-- 비밀번호 재설정 폼 -->
          <form th:action="@{/reset-password}" method="post" id="resetPasswordForm">
            <input type="hidden" name="token" th:value="${token}">

            <div class="mb-3">
              <label for="password" class="form-label">
                <i class="bi bi-key"></i> 새 비밀번호 <span class="text-danger">*</span>
              </label>
              <input type="password"
                     id="password"
                     name="password"
                     class="form-control form-input-sm"
                     placeholder="비밀번호 입력"
                     minlength="8"
                     required
                     autofocus>
              <small class="form-text text-muted">8자 이상 입력하세요.</small>
            </div>

            <div class="mb-3">
              <label for="confirmPassword" class="form-label">
                <i class="bi bi-key-fill"></i> 비밀번호 확인 <span class="text-danger">*</span>
              </label>
              <input type="password"
                     id="confirmPassword"
                     name="confirmPassword"
                     class="form-control form-input-sm"
                     placeholder="비밀번호 재입력"
                     minlength="8"
                     required>
              <small class="form-text text-muted" id="passwordMatch"></small>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary" style="height: 42px;">
                <i class="bi bi-check-circle"></i> 비밀번호 변경
              </button>
            </div>
          </form>

          <hr class="my-4">

          <!-- 추가 링크 -->
          <div class="text-center">
            <p class="mb-0">
              <a th:href="@{/login}" class="text-decoration-none">
                <i class="bi bi-arrow-left"></i> 로그인으로 돌아가기
              </a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // 비밀번호 일치 확인
  document.addEventListener('DOMContentLoaded', function() {
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirmPassword');
    const matchMessage = document.getElementById('passwordMatch');
    const form = document.getElementById('resetPasswordForm');

    function checkPasswordMatch() {
      if (confirmPassword.value === '') {
        matchMessage.textContent = '';
        matchMessage.classList.remove('text-success', 'text-danger');
        confirmPassword.classList.remove('is-valid', 'is-invalid');
        return;
      }

      if (password.value === confirmPassword.value) {
        matchMessage.textContent = '비밀번호가 일치합니다.';
        matchMessage.classList.remove('text-danger');
        matchMessage.classList.add('text-success');
        confirmPassword.classList.remove('is-invalid');
        confirmPassword.classList.add('is-valid');
      } else {
        matchMessage.textContent = '비밀번호가 일치하지 않습니다.';
        matchMessage.classList.remove('text-success');
        matchMessage.classList.add('text-danger');
        confirmPassword.classList.remove('is-valid');
        confirmPassword.classList.add('is-invalid');
      }
    }

    password.addEventListener('input', checkPasswordMatch);
    confirmPassword.addEventListener('input', checkPasswordMatch);

    // 폼 제출 전 검증
    form.addEventListener('submit', function(e) {
      if (password.value !== confirmPassword.value) {
        e.preventDefault();
        alert('비밀번호가 일치하지 않습니다.');
        confirmPassword.focus();
        return false;
      }

      if (password.value.length < 8) {
        e.preventDefault();
        alert('비밀번호는 8자 이상이어야 합니다.');
        password.focus();
        return false;
      }
    });
  });
</script>
</body>
</html>

